<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Expressing Love</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./css/auth.css">
    <link rel="stylesheet" href="./css/dashboard.css">
</head>
<body>
    <!-- Animated floating hearts background -->
    <div class="hearts-container" id="hearts-container"></div>

    <!-- Navigation Header -->
    <nav class="dashboard-nav">
        <div class="nav-content">
            <h2>💕 Expressing Love</h2>
            <div id="user-info" class="user-info"></div>
            <div id="auth-buttons" class="auth-buttons">
                <a href="login.html" class="nav-btn">Login</a>
                <a href="signup.html" class="nav-btn primary">Sign Up</a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container protected-content">
        <!-- Welcome Section -->
        <div class="dashboard-welcome">
            <h1>Welcome to Your Love Dashboard! 💖</h1>
            <p>Manage your profile, explore features, and express your love in beautiful ways.</p>
        </div>

        <!-- Quick Actions -->
        <div class="dashboard-grid">
            <!-- Profile Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>👤 My Profile</h3>
                </div>
                <div class="card-content">
                    <div id="profile-preview" class="profile-preview">
                        <div class="profile-avatar">
                            <img id="profile-image" src="/images/default-avatar.png" alt="Profile">
                        </div>
                        <div class="profile-info">
                            <h4 id="profile-name">Loading...</h4>
                            <p id="profile-email">Loading...</p>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button onclick="location.href='profile.html'" class="btn primary">Edit Profile</button>
                    </div>
                </div>
            </div>

            <!-- Love Features Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>💕 Love Features</h3>
                </div>
                <div class="card-content">
                    <div class="feature-grid">
                        <a href="confession.html" class="feature-link">
                            <div class="feature-icon">💌</div>
                            <span>Love Confession</span>
                        </a>
                        <a href="quiz.html" class="feature-link">
                            <div class="feature-icon">💕</div>
                            <span>Compatibility Quiz</span>
                        </a>
                        <a href="memory-book.html" class="feature-link">
                            <div class="feature-icon">📖</div>
                            <span>Memory Book</span>
                        </a>
                        <a href="gifts.html" class="feature-link">
                            <div class="feature-icon">🎁</div>
                            <span>Virtual Gifts</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Quick Settings Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>⚙️ Quick Settings</h3>
                </div>
                <div class="card-content">
                    <div class="settings-options">
                        <div class="setting-item">
                            <label>🎨 Theme:</label>
                            <select id="theme-selector" onchange="changeTheme()">
                                <option value="pink">💕 Pink</option>
                                <option value="red">❤️ Red</option>
                                <option value="purple">💜 Purple</option>
                                <option value="blue">💙 Blue</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>🔒 Privacy:</label>
                            <select id="privacy-selector" onchange="updatePrivacy()">
                                <option value="private">🔒 Private</option>
                                <option value="public">🌍 Public</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>📊 Your Activity</h3>
                </div>
                <div class="card-content">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="confessions-count">0</div>
                            <div class="stat-label">Confessions</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="memories-count">0</div>
                            <div class="stat-label">Memories</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="quizzes-count">0</div>
                            <div class="stat-label">Quizzes Taken</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- All Features Section -->
        <div class="all-features-section">
            <h2>🌟 All Features</h2>
            <div class="features-grid">
                <a href="quotes.html" class="feature-card">
                    <div class="feature-icon">💬</div>
                    <h3>Love Quotes</h3>
                    <p>Personalized romantic quotes</p>
                </a>
                
                <a href="reminders.html" class="feature-card">
                    <div class="feature-icon">📅</div>
                    <h3>Anniversary Reminders</h3>
                    <p>Never miss special dates</p>
                </a>
                
                <a href="voice-messages.html" class="feature-card">
                    <div class="feature-icon">🎤</div>
                    <h3>Voice Messages</h3>
                    <p>Record romantic messages</p>
                </a>
                
                <a href="confessions.html" class="feature-card">
                    <div class="feature-icon">🤫</div>
                    <h3>Anonymous Confessions</h3>
                    <p>Share your feelings anonymously</p>
                </a>
                
                <a href="chat.html" class="feature-card">
                    <div class="feature-icon">💬</div>
                    <h3>Love Chat</h3>
                    <p>Connect with your loved ones</p>
                </a>
                
                <a href="polls.html" class="feature-card">
                    <div class="feature-icon">📊</div>
                    <h3>Love Polls</h3>
                    <p>Create fun relationship polls</p>
                </a>
                
                <a href="bucket-list.html" class="feature-card">
                    <div class="feature-icon">📝</div>
                    <h3>Couple's Bucket List</h3>
                    <p>Plan your future together</p>
                </a>
                
                <a href="date-planner.html" class="feature-card">
                    <div class="feature-icon">📍</div>
                    <h3>Date Planner</h3>
                    <p>Plan perfect romantic dates</p>
                </a>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div id="loading-state" class="loading-state">
        <div class="loading-spinner">💖</div>
        <p>Loading your dashboard...</p>
    </div>

    <script type="module">
        import authManager from './js/auth.js';
        import { db, collection, query, where, getDocs } from './js/firebase-config.js';

        let currentTheme = 'pink';

        // Create floating hearts animation
        function createFloatingHearts() {
            const heartsContainer = document.getElementById('hearts-container');
            const hearts = ['💖', '💕', '💗', '💘', '💝', '💜', '❤️', '🧡', '💛', '💚', '💙'];
            
            setInterval(() => {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
                heart.style.opacity = Math.random() * 0.5 + 0.3;
                
                heartsContainer.appendChild(heart);
                
                setTimeout(() => {
                    heart.remove();
                }, 6000);
            }, 300);
        }

        async function loadUserProfile() {
            if (!authManager.currentUser) return;

            const profile = await authManager.getUserProfile();
            if (profile) {
                document.getElementById('profile-name').textContent = profile.displayName || 'Anonymous';
                document.getElementById('profile-email').textContent = profile.email || '';
                document.getElementById('profile-image').src = profile.photoURL || '/images/default-avatar.png';
                
                // Set theme and privacy
                document.getElementById('theme-selector').value = profile.theme || 'pink';
                document.getElementById('privacy-selector').value = profile.privacy || 'private';
                currentTheme = profile.theme || 'pink';
                
                // Apply theme
                applyTheme(currentTheme);
            }
        }

        async function loadUserStats() {
            if (!authManager.currentUser) return;

            try {
                // Load confessions count
                const confessionsQuery = query(
                    collection(db, 'confessions'),
                    where('userId', '==', authManager.currentUser.uid)
                );
                const confessionsSnapshot = await getDocs(confessionsQuery);
                document.getElementById('confessions-count').textContent = confessionsSnapshot.size;

                // Load memories count  
                const memoriesQuery = query(
                    collection(db, 'memories'),
                    where('userId', '==', authManager.currentUser.uid)
                );
                const memoriesSnapshot = await getDocs(memoriesQuery);
                document.getElementById('memories-count').textContent = memoriesSnapshot.size;

                // Load quizzes count
                const quizzesQuery = query(
                    collection(db, 'quizResults'),
                    where('userId', '==', authManager.currentUser.uid)
                );
                const quizzesSnapshot = await getDocs(quizzesQuery);
                document.getElementById('quizzes-count').textContent = quizzesSnapshot.size;

            } catch (error) {
                console.error('Error loading user stats:', error);
            }
        }

        function applyTheme(theme) {
            const root = document.documentElement;
            const themes = {
                pink: {
                    primary: '#ff6b9d',
                    secondary: '#ff9a9e',
                    accent: '#ffc1cc'
                },
                red: {
                    primary: '#e57373',
                    secondary: '#f06292',
                    accent: '#ffcdd2'
                },
                purple: {
                    primary: '#ba68c8',
                    secondary: '#ce93d8',
                    accent: '#e1bee7'
                },
                blue: {
                    primary: '#64b5f6',
                    secondary: '#90caf9',
                    accent: '#bbdefb'
                }
            };

            const themeColors = themes[theme] || themes.pink;
            root.style.setProperty('--primary-color', themeColors.primary);
            root.style.setProperty('--secondary-color', themeColors.secondary);
            root.style.setProperty('--accent-color', themeColors.accent);
        }

        window.changeTheme = async function() {
            const selectedTheme = document.getElementById('theme-selector').value;
            applyTheme(selectedTheme);
            
            // Update user profile with new theme
            if (authManager.currentUser) {
                await authManager.updateUserProfile({ theme: selectedTheme });
            }
        }

        window.updatePrivacy = async function() {
            const selectedPrivacy = document.getElementById('privacy-selector').value;
            
            // Update user profile with new privacy setting
            if (authManager.currentUser) {
                await authManager.updateUserProfile({ privacy: selectedPrivacy });
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            createFloatingHearts();
            
            // Wait for auth state to be determined
            setTimeout(() => {
                if (authManager.currentUser) {
                    document.getElementById('loading-state').style.display = 'none';
                    loadUserProfile();
                    loadUserStats();
                }
            }, 1000);
        });
    </script>
</body>
</html>