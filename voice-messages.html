<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Messages - Expressing Love</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./css/auth.css">
    <link rel="stylesheet" href="./css/dashboard.css">
</head>
<body>
    <!-- Animated floating hearts background -->
    <div class="hearts-container" id="hearts-container"></div>

    <!-- Back to Home Button -->
    <a href="index.html" class="back-home">🏠 Back to Home</a>

    <!-- Navigation Header -->
    <nav class="dashboard-nav">
        <div class="nav-content">
            <h2>💕 Expressing Love</h2>
            <div id="user-info" class="user-info"></div>
            <div id="auth-buttons" class="auth-buttons">
                <a href="login.html" class="nav-btn">Login</a>
                <a href="signup.html" class="nav-btn primary">Sign Up</a>
            </div>
        </div>
    </nav>

    <div class="container protected-content" style="margin-top: 100px; max-width: 900px;">
        <div class="page-header">
            <h1>🎤 Voice Messages</h1>
            <p>Record and send beautiful voice messages to your loved ones</p>
        </div>

        <!-- Recording Section -->
        <div class="recording-section">
            <h3>🎙️ Record New Voice Message</h3>
            
            <div class="recorder-interface">
                <div class="recording-visual" id="recording-visual">
                    <div class="microphone-icon">🎤</div>
                    <div class="recording-status" id="recording-status">Ready to record</div>
                    <div class="recording-timer" id="recording-timer">00:00</div>
                </div>

                <div class="recording-controls">
                    <button id="start-record-btn" onclick="startRecording()" class="record-btn">
                        🎤 Start Recording
                    </button>
                    <button id="stop-record-btn" onclick="stopRecording()" class="record-btn stop" style="display: none;">
                        ⏹️ Stop Recording
                    </button>
                    <button id="play-preview-btn" onclick="playPreview()" class="record-btn preview" style="display: none;">
                        ▶️ Play Preview
                    </button>
                </div>

                <div class="recording-preview" id="recording-preview" style="display: none;">
                    <audio id="preview-audio" controls></audio>
                    <div class="preview-actions">
                        <button onclick="saveRecording()" class="btn primary">💾 Save Recording</button>
                        <button onclick="discardRecording()" class="btn secondary">🗑️ Discard</button>
                    </div>
                </div>
            </div>

            <div class="recording-tips">
                <h4>📝 Recording Tips:</h4>
                <ul>
                    <li>🎧 Use headphones for better audio quality</li>
                    <li>🤫 Find a quiet environment</li>
                    <li>💕 Speak from your heart</li>
                    <li>⏱️ Keep messages under 3 minutes for best experience</li>
                </ul>
            </div>
        </div>

        <!-- Voice Messages Library -->
        <div class="voice-library">
            <div class="section-header">
                <h3>🎵 Your Voice Messages</h3>
                <div class="library-filters">
                    <button class="filter-btn active" onclick="filterMessages('all')">All</button>
                    <button class="filter-btn" onclick="filterMessages('recent')">Recent</button>
                    <button class="filter-btn" onclick="filterMessages('favorites')">❤️ Favorites</button>
                </div>
            </div>

            <div id="voice-messages-container" class="voice-messages-grid">
                <!-- Voice messages will be loaded here -->
            </div>

            <div id="no-messages" class="empty-state" style="display: none;">
                <div class="empty-icon">🎤</div>
                <h3>No voice messages yet</h3>
                <p>Record your first voice message to get started!</p>
            </div>
        </div>

        <!-- Send Message Modal -->
        <div id="send-message-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>📤 Send Voice Message</h3>
                    <span class="close" onclick="closeModal('send-message-modal')">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="message-preview" id="message-preview">
                        <!-- Selected message preview -->
                    </div>
                    
                    <form id="send-message-form">
                        <input type="hidden" id="selected-message-id">
                        
                        <div class="form-group">
                            <label for="recipient-name">💕 Send to</label>
                            <input type="text" id="recipient-name" placeholder="Recipient's name or email" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="message-title">💌 Message Title</label>
                            <input type="text" id="message-title" placeholder="Give your message a title..." required>
                        </div>
                        
                        <div class="form-group">
                            <label for="accompanying-text">📝 Accompanying Text (Optional)</label>
                            <textarea id="accompanying-text" rows="3" placeholder="Add some text to go with your voice message..."></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn primary">📤 Send Message</button>
                            <button type="button" onclick="closeModal('send-message-modal')" class="btn secondary">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Feature Status -->
        <div class="feature-status">
            <div class="status-header">
                <h3>🚧 Development Status</h3>
            </div>
            <div class="status-content">
                <div class="status-item">
                    <span class="status-label">🎤 Audio Recording:</span>
                    <span class="status-value">📋 Planned (Web Audio API integration)</span>
                </div>
                <div class="status-item">
                    <span class="status-label">💾 Audio Storage:</span>
                    <span class="status-value">📋 Planned (Firebase Storage integration)</span>
                </div>
                <div class="status-item">
                    <span class="status-label">🎵 Audio Playback:</span>
                    <span class="status-value">📋 Planned (HTML5 Audio API)</span>
                </div>
                <div class="status-item">
                    <span class="status-label">📤 Message Sharing:</span>
                    <span class="status-value">📋 Planned (Email/social integration)</span>
                </div>
            </div>
            <div class="implementation-note">
                <h4>🔧 Implementation Notes:</h4>
                <p>This feature requires Web Audio API implementation for recording, Firebase Storage for audio file storage, and additional backend logic for message management. The UI is fully designed and ready for integration.</p>
                
                <h4>📚 Technical Requirements:</h4>
                <ul>
                    <li><strong>MediaRecorder API</strong>: For recording audio from user's microphone</li>
                    <li><strong>Firebase Storage</strong>: For storing audio files with proper security rules</li>
                    <li><strong>Audio Format Handling</strong>: Support for WebM, MP3, and WAV formats</li>
                    <li><strong>Compression</strong>: Audio compression for efficient storage and transmission</li>
                    <li><strong>Real-time Waveform</strong>: Visual feedback during recording</li>
                </ul>
            </div>
        </div>

        <!-- Navigation -->
        <div class="page-navigation">
            <a href="dashboard.html" class="btn secondary">← Back to Dashboard</a>
            <a href="gifts.html" class="btn primary">🎁 Virtual Gifts</a>
        </div>
    </div>

    <script type="module">
        import './js/auth-guard.js';
        import authManager from './js/auth.js';

        let currentUser = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;
        let recordingTimer = null;
        let recordingTime = 0;

        function createFloatingHearts() {
            const heartsContainer = document.getElementById('hearts-container');

    <!-- Back to Home Button -->
    <a href="index.html" class="back-home">🏠 Back to Home</a>
            const hearts = ['💖', '💕', '💗', '💘', '💝', '💜', '❤️', '🧡', '💛', '💚', '💙'];
            
            setInterval(() => {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
                heart.style.opacity = Math.random() * 0.5 + 0.3;
                
                heartsContainer.appendChild(heart);
                
                setTimeout(() => {
                    heart.remove();
                }, 6000);
            }, 300);
        }

        // Voice recording functions (placeholders for future implementation)
        window.startRecording = async function() {
            try {
                // TODO: Implement actual recording with MediaRecorder API
                showToast('🚧 Voice recording feature is under development. Coming soon!', 'info');
                
                // Simulate recording interface for now
                document.getElementById('recording-status').textContent = 'Recording...';
                document.getElementById('start-record-btn').style.display = 'none';
                document.getElementById('stop-record-btn').style.display = 'inline-block';
                
                // Simulate recording timer
                recordingTime = 0;
                recordingTimer = setInterval(() => {
                    recordingTime++;
                    const minutes = Math.floor(recordingTime / 60).toString().padStart(2, '0');
                    const seconds = (recordingTime % 60).toString().padStart(2, '0');
                    document.getElementById('recording-timer').textContent = `${minutes}:${seconds}`;
                }, 1000);
                
                /*
                // Actual implementation would be:
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(blob);
                    document.getElementById('preview-audio').src = audioUrl;
                    document.getElementById('recording-preview').style.display = 'block';
                };
                
                mediaRecorder.start();
                isRecording = true;
                */
                
            } catch (error) {
                console.error('Error starting recording:', error);
                showToast('Error accessing microphone. Please check permissions.', 'error');
            }
        };

        window.stopRecording = function() {
            if (recordingTimer) {
                clearInterval(recordingTimer);
                recordingTimer = null;
            }
            
            document.getElementById('recording-status').textContent = 'Recording stopped';
            document.getElementById('start-record-btn').style.display = 'inline-block';
            document.getElementById('stop-record-btn').style.display = 'none';
            document.getElementById('play-preview-btn').style.display = 'inline-block';
            
            // TODO: Actual implementation would call mediaRecorder.stop()
            showToast('Recording stopped. Preview functionality coming soon!', 'info');
        };

        window.playPreview = function() {
            // TODO: Implement audio preview playback
            showToast('Audio preview feature coming soon!', 'info');
        };

        window.saveRecording = function() {
            // TODO: Implement saving to Firebase Storage
            showToast('Save recording feature coming soon!', 'info');
        };

        window.discardRecording = function() {
            document.getElementById('recording-preview').style.display = 'none';
            document.getElementById('recording-status').textContent = 'Ready to record';
            document.getElementById('recording-timer').textContent = '00:00';
            recordedChunks = [];
            showToast('Recording discarded', 'info');
        };

        window.filterMessages = function(filter) {
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // TODO: Implement actual filtering logic
            loadVoiceMessages(filter);
        };

        window.closeModal = function(modalId) {
            document.getElementById(modalId).style.display = 'none';
        };

        function loadVoiceMessages(filter = 'all') {
            const container = document.getElementById('voice-messages-container');
            const noMessagesDiv = document.getElementById('no-messages');
            
            // TODO: Load actual voice messages from Firebase
            // For now, show empty state
            container.style.display = 'none';
            noMessagesDiv.style.display = 'block';
        }

        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 4000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createFloatingHearts();
            
            setTimeout(() => {
                currentUser = authManager.currentUser;
                if (currentUser) {
                    loadVoiceMessages();
                }
            }, 1000);
        });
    </script>

    <style>
        .page-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .page-header h1 {
            color: var(--primary-color, #ff6b9d);
            margin-bottom: 10px;
        }

        .recording-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .recording-section h3 {
            color: var(--primary-color, #ff6b9d);
            margin-bottom: 25px;
        }

        .recorder-interface {
            text-align: center;
            padding: 30px;
            border: 3px dashed rgba(255, 107, 157, 0.3);
            border-radius: 20px;
            margin-bottom: 30px;
        }

        .recording-visual {
            margin-bottom: 30px;
        }

        .microphone-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .recording-status {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .recording-timer {
            font-size: 2rem;
            font-family: 'Courier New', monospace;
            color: var(--primary-color, #ff6b9d);
            font-weight: bold;
        }

        .recording-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .record-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .record-btn:not(.stop):not(.preview) {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
        }

        .record-btn.stop {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .record-btn.preview {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
        }

        .record-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .recording-preview {
            background: rgba(255, 107, 157, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .preview-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .recording-tips {
            background: rgba(33, 150, 243, 0.1);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #2196f3;
        }

        .recording-tips h4 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .recording-tips ul {
            list-style: none;
            padding: 0;
        }

        .recording-tips li {
            margin-bottom: 8px;
            color: #333;
        }

        .voice-library {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-header h3 {
            color: var(--primary-color, #ff6b9d);
            margin: 0;
        }

        .library-filters {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 2px solid var(--primary-color, #ff6b9d);
            background: transparent;
            color: var(--primary-color, #ff6b9d);
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: var(--primary-color, #ff6b9d);
            color: white;
        }

        .voice-messages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .feature-status {
            background: rgba(255, 243, 224, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #ff9800;
        }

        .status-header h3 {
            color: #f57c00;
            margin-bottom: 20px;
        }

        .status-content {
            margin-bottom: 25px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(245, 124, 0, 0.2);
        }

        .status-label {
            font-weight: bold;
            color: #333;
        }

        .status-value {
            color: #f57c00;
            font-weight: bold;
        }

        .implementation-note {
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .implementation-note h4 {
            color: #d84315;
            margin-bottom: 15px;
        }

        .implementation-note ul {
            margin-left: 20px;
        }

        .implementation-note li {
            margin-bottom: 8px;
            color: #333;
        }

        .page-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin-top: 40px;
        }

        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: #4caf50;
        }

        .toast.error {
            background: #f44336;
        }

        .toast.info {
            background: #2196f3;
        }

        @media (max-width: 768px) {
            .recording-controls {
                flex-direction: column;
                align-items: center;
            }

            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .library-filters {
                justify-content: center;
            }

            .page-navigation {
                flex-direction: column;
            }

            .status-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }
    </style>
</body>
</html>